#
# Copyright 2026 The Kubeflow authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

# Default values for trainer.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# -- String to partially override release name.
nameOverride: ""

# -- String to fully override release name.
fullnameOverride: ""

jobset:
  # -- Whether to install jobset as a dependency managed by trainer.
  # This must be set to `false` if jobset controller/webhook has already been installed into the cluster.
  install: true
  # -- String to fully override jobset release name.
  fullnameOverride: jobset

# -- Common labels to add to the resources.
commonLabels: {}

image:
  # -- Image registry.
  registry: ghcr.io
  # -- Image repository.
  repository: kubeflow/trainer/trainer-controller-manager
  # -- Image tag. Defaults to the chart version formatted for the appropriate image tag.
  tag: ""
  # -- Image pull policy.
  pullPolicy: IfNotPresent
  # -- Image pull secrets for private image registry.
  pullSecrets: []
  # - name: <secret-name>

manager:
  # -- Number of replicas of manager.
  replicas: 1

  # -- Extra labels for manager pods.
  labels: {}
    # key1: value1
    # key2: value2

  # -- Extra annotations for manager pods.
  annotations: {}
    # key1: value1
    # key2: value2

  # -- Volumes for manager pods.
  volumes: []

  # -- Node selector for manager pods.
  nodeSelector: {}

  # -- Affinity for manager pods.
  affinity: {}

  # -- List of node taints to tolerate for manager pods.
  tolerations: []

  # -- Environment variables for manager containers.
  env: []

  # -- Environment variable sources for manager containers.
  envFrom: []

  # -- Volume mounts for manager containers.
  volumeMounts: []

  # -- Pod resource requests and limits for manager containers.
  resources: {}
    # limits:
    #   cpu: 100m
    #   memory: 300Mi
    # requests:
    #   cpu: 100m
    #   memory: 300Mi

  # -- Security context for manager containers.
  securityContext:
    allowPrivilegeEscalation: false
    runAsNonRoot: true
    capabilities:
      drop:
      - ALL
    seccompProfile:
      type: RuntimeDefault

  # -- Controller manager configuration.
  # This configuration is used to generate the ConfigMap for the controller manager.
  config:
    health:
      healthProbeBindAddress: ":8081"
      readinessEndpointName: "readyz"
      livenessEndpointName: "healthz"
    metrics:
      bindAddress: ":8443"
      secureServing: true
    webhook:
      port: 9443
      host: ""
    leaderElection:
      leaderElect: true
      resourceName: "trainer.kubeflow.org"
      resourceNamespace: ""
      leaseDuration: "15s"
      renewDeadline: "10s"
      retryPeriod: "2s"
    controller:
      groupKindConcurrency:
        trainJob: 5
        trainingRuntime: 1
        clusterTrainingRuntime: 1
    certManagement:
      enable: true
      # webhookServiceName and webhookSecretName are auto-generated if not specified
      webhookServiceName: ""
      webhookSecretName: ""
    featureGates: {}

webhook:
  # -- Specifies how unrecognized errors are handled.
  # Available options are `Ignore` or `Fail`.
  failurePolicy: Fail

dataCache:
  # -- Enable/disable data cache support (LWS dependency, ClusterRole).
  # Set to `true` to install data cache components.
  enabled: false
  lws:
    # -- Whether to install LeaderWorkerSet as a dependency.
    # Set to `false` if LeaderWorkerSet is already installed in the cluster.
    install: true
    # -- String to fully override LeaderWorkerSet release name.
    fullnameOverride: lws
  cacheImage:
    # -- Data cache image registry
    registry: ghcr.io
    # -- Data cache image repository
    repository: kubeflow/trainer/data-cache
    # -- Data cache image tag. Defaults to chart version if empty.
    tag: ""
  runtimes:
    # -- PyTorch distributed training with data cache support
    torchDistributedWithCache:
      # -- Enable deployment of torch-distributed-with-cache runtime
      enabled: false

# -- ClusterTrainingRuntimes configuration
# These are optional runtime templates that can be deployed with the Helm chart.
# Each runtime provides a blueprint for different ML frameworks and configurations.
runtimes:
  # -- Enable all default runtimes (torch, deepspeed, mlx, jax, torchtune) when set to true.
  # Individual runtime settings will be ignored if this is enabled.
  defaultEnabled: false

  # -- PyTorch distributed training runtime (no custom images required)
  torchDistributed:
    # -- Enable deployment of torch-distributed runtime
    enabled: false

  # -- DeepSpeed distributed training runtime
  deepspeedDistributed:
    # -- Enable deployment of deepspeed-distributed runtime
    enabled: false
    image:
      # -- DeepSpeed runtime image registry
      registry: ghcr.io
      # -- DeepSpeed runtime image repository
      repository: kubeflow/trainer/deepspeed-runtime
      # -- DeepSpeed runtime image tag. Defaults to chart version if empty.
      tag: ""

  # -- MLX distributed training runtime
  mlxDistributed:
    # -- Enable deployment of mlx-distributed runtime
    enabled: false
    image:
      # -- MLX runtime image registry
      registry: ghcr.io
      # -- MLX runtime image repository
      repository: kubeflow/trainer/mlx-runtime
      # -- MLX runtime image tag. Defaults to chart version if empty.
      tag: ""

  # -- JAX distributed training runtime (no custom images required)
  jaxDistributed:
    # -- Enable deployment of jax-distributed runtime
    enabled: false

  # -- TorchTune distributed training runtime
  torchtuneDistributed:
    image:
      # -- TorchTune runtime image registry
      registry: ghcr.io
      # -- TorchTune runtime image repository
      repository: kubeflow/trainer/torchtune-trainer
      # -- TorchTune runtime image tag. Defaults to chart version if empty.
      tag: ""

    # -- Llama 3.2 1B model configuration
    llama3_2_1B:
      # -- Enable deployment of Llama 3.2 1B runtime
      enabled: false

    # -- Llama 3.2 3B model configuration
    llama3_2_3B:
      # -- Enable deployment of Llama 3.2 3B runtime
      enabled: false

    # -- Qwen 2.5 1.5B model configuration
    qwen2_5_1_5B:
      # -- Enable deployment of Qwen 2.5 1.5B runtime
      enabled: false
